---
title: 'New algorithms for effectively visualising Australian spatio-temporal disease data.'
degreetype: 'Master of Philosophy (Statistics)'
author: 'Stephanie Rose Kobakian'
degrees: 'B.Comm. and B.Eco., Monash University'
output: bookdown::pdf_book
site: bookdown::bookdown_site
link-citations: yes
knit: "bookdown::render_book"
---

<!-- 
Edit these lines as appropriate.
The actual thesis content is in several Rmd files.

You'll need to edit the _bookdown.yml file to set the order in which you'd like them to appear. 

If you have specific LaTeX packages to add, put them in monashthesis.tex.

You will need to ensure you have installed the knitr and bookdown packages for R.

You will also need LaTeX installed on your computer.
-->

<!--chapter:end:index.Rmd-->

---
knit: "bookdown::render_book"
---

# Copyright notice {-}


\textcopyright { } \authorname\ (\number\the\year). 

I certify that I have made all reasonable efforts to secure copyright permissions for third-party content included in this thesis and have not knowingly added copyright content to my work without the owner's permission.

\newpage

<!--chapter:end:00-copyright.Rmd-->

---
knit: "bookdown::render_book"
---

# Keywords {-}

Keywords: maps; statistics; geospatial statistics; visual inference; cartogram; tile maps; choropleth

<!--chapter:end:00-keywords.Rmd-->

---
knit: "bookdown::render_book"
---

# Abstract {-}


<!--less than 500 words-->
The Australian population has congregated in the capital cities and significant cities in each state. This pattern has resulted in very dense population centres and sparsely populated rural areas. The relationship between the Australian population and the geographic area they live in results in a heterogeneous distribution of the map space. The goal of many spatial visualisations is to gain a broad perspective of the values of statistics over the Australian population. However, the use of most mapping techniques can mislead, as the use of geographical areas unequally presents the spatial distribution of a dataset.

As part of this thesis, an algorithm is presented which will take geospatial areas in the form of polygons and create an alternative graphical display of a spatial distribution. This algorithm takes a set of polygons and creates a map of tessellated hexagons, representing a single geographical area with a single hexagon. It arranges them to replicate spatial relationships of geographic areas in each city. The hexagon tile map visualisation produced by the algorithm is contrasted with the traditional choropleth map.
The package `sugarbag` [@sugarbag] implements the algorithm for the statistical software `R` [@R].


Using animations will allow us to control how people transform a recognisable map of Australia, or the cities within, into a more reliable map for inference. Animation is gaining popularity as access to computing power is increasing the amount of applications.

\newpage

<!--chapter:end:00-abstract.Rmd-->

---
knit: "bookdown::render_book"
---

# Declaration {-}


I hereby declare that this thesis contains no material which has been accepted for the award of any other degree or diploma at any university or equivalent institution and that, to the best of my knowledge and belief, this thesis contains no material previously published or written by another person, except where due reference is made in the text of the thesis. 

This thesis includes three original papers submitted to peer reviewed journals. The core theme of the thesis is spatial visualisations. The ideas, development and writing up of all the papers in the thesis were the principal responsibility of myself, the student, working within the Faculty of Science and Engineering under the supervision of Distinguished Professor Kerrie Mengersen and Dr. Earl Duncan. It was also created under the supervision of the external supervisor Professor Dianne Cook.


I have not renumbered sections of submitted or published papers, instead they are individually formatted for journal submission.

<!--chapter:end:00-declaration.Rmd-->

---
knit: "bookdown::render_book"
---

# Acknowledgements {-}

This thesis would not be possible without the opportunity provided by Queensland University of Technology, Cancer Council Queensland and the ARC Centre of Excellence for Mathematical & Statistical Frontiers.

I would like to acknowledge my supervisors for their tireless work in directing, encouraging and supporting this work.

Professor Kerrie Mengersen (Professor of Statistics, Science and Engineering Faculty, QUT) provided the opportunity to study at Queensland University of Technology, organising and supervising this project.

Dr Earl Duncan (Research Associate at ARC Centre of Excellence for Mathematical & Statistical Frontiers, QUT) provided time and effort for to discussion, editing and commenting throughout this degree.

Professor Dianne Cook (Professor, Department of Econometrics and Business Statistics, Monash University) provided constant support, encouragement and recommendations throughout this degree.
Working closely with Prof.. Di Cook enabled the rapid development of my research and writing skills. 

## Literature review

We would like to acknowledge Dr Susanna Cramb (Spatial Modeller, Cancer Council Queensland) and Dr Peter Baade (Senior Research Fellow, Cancer Council Queensland) for providing the opportunity and time to discuss alternative map solutions for presentation in the Australian Cancer Atlas.
It was in the development of this online cancer atlas that methods for disease map displays, and visual communication strategies were explored. 

## Visual inference study

Stephanie would like to thank Mitchell O'Hara-Wild was a co-developer of the taipan [@taipan] R package for the web app constructed to collect participant evaluations of lineups. 

We are thankful for the NUMBATs (Non-Uniform Monash Business Analytics Team) for participating in the pilot study that helped to assess the experimental design and determine an appropriate sample size for the study. 

## R packages 

Several `R` [@R] packages were used to produce this thesis:

 - `absmapsdata` [@ABSmaps]
 - `cartogram` [@cartogram]
 - `cowplot` [@cowplot]
 - `eechidna` [@eechidna]
 - `ggplot2` [@ggplot2] 
 - `ggthemes` [@ggthemes]
 - `grid` [@grid]
 - `gstat` [@gstat]
 - `kableExtra` [@kableExtra].
 - `knitr` [@knitr]
 - `lme4` [@lme4]
 - `nullabor` [@nullabor]
 - `png` [@png]
 - `RColorBrewer` [@RColorBrewer] 
 - `rmarkdown` [@rmarkdown] 
 - `rticles` [@rticles]
 - `sf` [@sf] 
 - `spData` [@spData] 
 - `sugarbag` [@sugarbag]
 - `tidyverse` [@tidyverse]

<!--chapter:end:00-acknowledge.Rmd-->

---
knit: "bookdown::render_book"
---

# Preface {-}

1. The literature review exploring current practice for visualising spatial data in Chapter \ref{ch:literature} has been submitted to the journal *Annals of Cancer Epidemiology* for publication.
  
Kobakian S. and Cook, D. and Roberts, J. (2019). Cancer Applications of Choropleth Maps, and the Potential of Cartograms and Alternative Map Displays. Manuscript submitted for publication.


2.  The details of the algorithm documented in Chapter \ref{ch:algorithm} have been submitted to the *Journal of Statistical Software*.

Kobakian S. and Cook, D. (2020). An Algorithm For Spatial Mapping Using a Hexagon Tile Map, With Application to Australian Maps. Manuscript submitted for publication.


3.  The details of the visual inference testing is documented in Chapter \ref{ch:experiment} has been submitted to the *IEEE Transactions of Visualisation and Computer Graphics* under the title "Comparing the Effectiveness of the Choropleth Map with a Hexagon Tile Map for Communicating Cancer"

Kobakian S. and Cook, D. (2020). Comparing the Effectiveness of the Choropleth Map
with a Hexagon Tile Map for Communicating Cancer Manuscript submitted for publication.


4.  The code for the algorithm documented in Chapter \ref{ch:algorithm} is currently hosted on *CRAN* as the package sugarbag.

  Kobakian, S. and Cook, D. (2019). sugarbag: Create Tessellated Hexagon Maps. https://srkobakian.github.io/sugarbag/, https://github.com/srkobakian/sugarbag.
  
  
\clearpage\pagenumbering{arabic}\setcounter{page}{0}

<!--chapter:end:00-preface.Rmd-->

---
knit: "bookdown::render_book"
---

# List of Figures {-}

```{r}

figs2 <- tibble::tibble(
  Chapter = c(rep("2", 6)),
  Figure = c(seq(1:6)),
  Caption = c(
    "A selection of choropleth cancer maps from online atlases that are publicly available.",
    "Common alternatives to maps, showing the same information for the United States of America.",
    "Two alternative displays, tile map (left) and geofaceted map (right), showing state age-adjusted rate of incidence for lung and bronchus in the USA.",
    "Cartograms showing melanoma incidence in Australia.",
    "Interactive controls of displays in publicly available choropleth cancer maps",
    "Two examples of advanced interactivity (and animation) in publicly available choropleth cancer maps.")
)

figs3 <- tibble::tibble(
  Chapter = c(rep("3", 6)),
  Figure = c(seq(1:6)),
  Caption = c(
    "Grid points to create a tilegram.",
    "All possible hexagon locations from the initial grid are shown with blue outlines.",
    "Filter for grid points within a square, then circular, distance for those closest to the centroid.",
    " A complete hexagon tile map of Tasmania",
    "The Australian Cancer Atlas data has determined the colour of each Statistical Area of Australian at Level 2",
    "A choropleth map of the Statistical Areas of Australia at Level 2."))


figs4 <- tibble::tibble(
  Chapter = c(rep("4", 7)),
  Figure = c(seq(1:7)),
  Caption = c(
    "A choropleth map of the smoothed average of liver cancer diagnoses for Australian males.",
    "A hexagon tile map of the smoothed average of liver cancer diagnoses for Australian males.",
    "This lineup of twelve hexagon tile map displays contains one map with a real population related structure.",
    "The experimental design used in the visual inference study.",
    "The detection rates achieved by participants are contrasted when viewing the four replicates of the three trend models",
    "The distribution of the time taken (seconds) to submit a response for each combination of trend, whether the data plot was detected, and type of display, shown using horizontally jittered dotplots.",
    "The amount of times each level of certainty was chosen by participants when viewing hexagon tile map or choropleth displays.")
)
```


<!--chapter:end:00-figures.Rmd-->

---
knit: "bookdown::render_book"
---

# List of Tables {-}

```{r}

tabs2 <- tibble::tibble(
  Chapter = c(rep("2", 6)),
  Table = c(seq(1:6)),
  Caption = c(
    "A selection of choropleth cancer maps from online atlases that are publicly available.",
    "Common alternatives to maps, showing the same information for the United States of America.",
    "Two alternative displays, tile map (left) and geofaceted map (right), showing state age-adjusted rate of incidence for lung and bronchus in the USA.",
    "Cartograms showing melanoma incidence in Australia.",
    "Interactive controls of displays in publicly available choropleth cancer maps",
    "Two examples of advanced interactivity (and animation) in publicly available choropleth cancer maps.")
)

```


<!--chapter:end:00-tables.Rmd-->

---
chapter: 1
knit: "bookdown::render_book"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message=FALSE, cache=TRUE)
# Load any R packages you need here
library(forecast)
library(ggplot2)
```

# Introduction {#ch:intro}

There are many visualisation methods used to present geospatial data. The design of the visualisation chosen can hinder or improve the communication of the spatial distribution. A choropleth map is the most common display used to present geographical data. Maps contribute to understanding spatial distributions of disease occurrence, and locating disease clusters. Disease data is often aggregated by political areas. One reason for this is privacy and another is the responsibility on the political entity to respond. The typical visualisation for aggregated spatial data is a choropleth map, where areas are coloured by the numerical value. 

Choropleth maps do a disservice to the map reader, as the attention of the map user is distributed according to the size of the area. Using a choropleth map to get a broad perspective of Australia can be misleading, when the use of geographical areas misrepresents the spatial distribution of a dataset. This is not practical if each area is considered equally important. In Australia, the population is not equally dispersed across the geographic map base. 
Instead, the communities are densely populated in the inner city areas, especially around the capital cities. There are several visualisation methods that have been developed to emphasise the population dense areas. These alternatives should be considered when planning the communication of geospatial statistics, visualisations should be chosen to best represent the spatial distribution. The work is motivated by the Australian Cancer Atlas,
which presents the spatial patterns of many cancers in Australia. The aim of this thesis is to contribute an algorithm that creates effective visualisations for the communication of geospatial population statistics.


## The Australian Cancer Atlas

This work was motivated by the Australian Cancer Atlas (ACA), an online, interactive web tool for exploring the impact of cancer on Australian communities. The prominent display used by the ACA is a visualisation of incidence rates or excess death rates. The set of geographic units used is Australian Statistical Areas, at Level 2 (SA2s). There are almost 2,200 individual SA2s.

The choropleth map used in the ACA is familiar to the general public of Australia. It is appropriate to use this display as users can orient themselves on the map base and find geographic areas relevant to them.
However, when the intention of the map user is to convey the whole spatial distribution the information derived visually from the colours can be misleading.
The rural areas are over emphasised, and the densely populated inner city areas are not given enough attention.

## Visual Inference

Visual inference will be used to determine if the communication of population geospatial statistics is more effective when using an alternative display.
Buja et al [@GIIV] provide the 'lineup' protocol as a formal framework for testing visual statistical methods. Implementing this framework will allow new alternative visualisation method to be tested.

The lineup protocol will be used to test if a visualisation is effective, a visualisation displaying a real population based distribution can be hidden in a collection of visualisations that display null distributions [@chowd]. 
It takes inspiration from a police lineup.
The witness in this regard is a participant recruited from a crowdsource platform, such as Figure-Eight.
The visualisation containing a real distribution is considered the 'accused'.
It is put in a lineup of innocent displays that do not show a real population based distribution.
If the 'witness' chooses the 'accused' as different from the innocent plots, it can be considered that there is a specific pattern displayed that is not present in the others. 
In this protocol, the null hypothesis can be rejected in favour of the alternative when it is chosen in the lineup. The null hypothesis fails to be rejected when it is not selected in the lineup.



## Aims and Objectives

This work aims to provide a solution to presenting geospatial data regarding populations. 
It considers the visualisation methods developed over the past two centuries that shift the focus from the geographic map base.

1. *Devising an Algorithm for creating hexagon tile maps of Australia:* The algorithm will take geospatial areas and create an alternative visualisation of the spatial distribution.

2. *Test the effectiveness of the hexagon tile map relative to the choropleth map:* The hexagon tile map produced by the algorithm will be contrasted with the traditional choropleth map, applying the same colour methods to represent the data. The maps will be used in an experiment to test the effectiveness by asking for users to spot spatial distributions.

3. *Communicating the relationship between the hexmap and choropleth map through animation:* Maximise the benefits of both displays when communicating to the public. The use of animations may control how people follow a recognisable map of Australia into an alternative visualisation for inference. 

## Research Contributions

This research contributes a new algorithm for creating hexagon tile map displays. It contributes an R [@R] package which implements the algorithm and allows R users to create their own visualisations.
It presents a case study that contributes to a growing field of visual inference studies, applied to spatial data by comparing a choropleth map to a hexagon tile map display.
It also shows how it can be used in practice to effectively communicate cancer distributions.


## Thesis Structure

The thesis is structured as follows: Chapter two contains a literature review. 
The literature reviews considers the current peer reviewed literature and published books that explore spatial distributions of cancer across the globe.
It also considers how to evaluate the visualisation methods used for spatial data.

Chapter three explores the algorithm to create hexagon tile maps and the code used to create a small example of Tasmania in Australia.
Chapter four is a visual inference study that contains the methods and results that compare the use of a choropleth map and a hexagon tile map on the same data sets.
Chapter five provides a conclusion of the results of the visual inference study and how the hexagon tile map may be used in practice.

<!--chapter:end:01-intro.Rmd-->

---
chapter: 2
knit: "bookdown::render_book"
---

# Literature Review {#ch:literature}

\includepdf[pages = {1-}, scale=0.8]{statement-of-contribution_literature.pdf}

\includepdf[pages = {1-}, scale=1]{~/review/review_article.pdf}

<!--chapter:end:02-literature.Rmd-->

---
chapter: 3
knit: "bookdown::render_book"
---


# An algorithm for creating a tessellated hexagon display {#ch:algorithm}

\includepdf[pages = {1-}, scale=0.8]{statement-of-contribution_algorithm.pdf}

\includepdf[pages = {1-}, scale=1]{~/algorithm/kobakian_sugarbag_jss/kobakian_sugarbag_jss.pdf}

<!--chapter:end:03-algorithm.Rmd-->

---
chapter: 4
knit: "bookdown::render_book"
---

# Visual Inference Study {#ch:experiment}

\includepdf[pages = {1-}, scale=0.8]{statement-of-contribution_experiment.pdf}

\includepdf[pages = {1-}, scale=1]{~experiment/paper/paper.pdf}

<!--chapter:end:04-experiment.Rmd-->

---
chapter: 5
knit: "bookdown::render_book"
---


# Discussion  {#ch:discussion}

This chapter discusses the use of the choropleth map in presenting spatial data.
It discusses the hexagon tile map algorithm contributed by this thesis and discusses its similarities and differences from other alternative visualisation methods.
It discusses the use of the visual inference study for evaluating the displays produced by the hexagon tile map algorithm for Australia. Finally, it discusses how animating between a choropleth and hexagon display can allow map creators to direct the attention of users to the overlooked, small but densely populated geographic areas.

## Presenting spatial data

Choropleth map displays are the traditional, and current practice method for presenting geospatial data. The use of familiar geographic polygons allows users to readily find areas of interest on the map display [@EI]. The spatial patterns among the areas are revealed via the colour used to fill each geographic area. 

Cancer Atlases are used to develop hypotheses about spatial distributions of cancer statistics [@CPISACA]. Hot spots with high values can be detected by dramatic changes in colour between neighbours [@MACM].


However, when used as a tool communicate spatial distributions the use of the choropleth map may lead to misinterpretation of the overall distribution. This is because of the overemphasis on the large geographic areas, and the lack of visibility for the small inner-city communities [@ACTUC].


Visualisation methods have improved in iterations over many years. Cartograms [@ACCAC] showed great promise and several algorithms were presented to create cartograms in the 1960s and 1970s. Cartogram techniques highlighted the population by expanding the map area of densely populated communities.
The introduction of computer assisted cartogram techniques were developed in the 1970s and 1980s. Dorling [@TVSSS], [@ACTUC] introduced several alternative visualisation methods and their use has had a profound impact in the communication of data with population related distributions. These displays enabled viewers to physically see the densely populated areas and avoid spending attention on less populated, but geographically large map areas [@CTTMB].

## The hexagon tile map algorithm

<!--
1. *Algorithm for creating hexagon tile maps of Australia:* The algorithm will take geospatial areas and create an alternative visualisation of the spatially distribution.

discuss the results with reference to the literature, for example, the similarities/differences to the findings in the literature review.
-->

A key aim of this thesis was to present an algorithm for displaying geospatial data. The  algorithm presented in chapter algorithm is the result of many iterations in the process necessary to transform geographic areas into a tessellated hexagon tile map.


The tessellation employed in the hexagon tile map algorithm maintains connectedness between neighbouring areas, this draws inspiration from contiguous cartograms [@ACA], rectangular cartograms [@RSCW] and Dorling's circular cartograms [@ACTUC]. However, the hexagon tile map algorithm does not employ the gravitation pull mathematics that is used to create contiguous cartograms. It also does not iterate on the placement of hexagons.  
The choice of the hexagon, a consistent shape used for all areas, also draws from rectangular and Dorling cartograms. This encourages map readers to focus on the  similarities or difference in the colour between geographic neighbours, and does not distract them with unfamiliar boundaries after a contiguous cartogram transformation. 

The hexagon tile map display is least like the non-contiguous cartogram [@NAC] which maintains the familiar geographic shapes. Some similarity in the final results may occur as densely populated regions maintain connectivity with neighbours, and sparsely populated areas will use the underlying white map space to separate neighbours.

The implementation of the `sugarbag` [@sugarbag] package for R [@R] provides map creators the opportunity to apply the algorithm to any set of geospatial polygons. This does not require manual creation of grids, but the displays are reusable for any populated related data set that uses the same set of geographic units.


## Visual inference study

<!--
2. *Test the effectiveness of the hexagon tile map relative to the choropleth map:* The hexagon tile map produced by the algorithm will be contrasted with the traditional choropleth map, applying the same colour methods to represent the data. The maps will be used in an experiment to test the effectiveness by asking for users to spot spatial distributions.

discuss the results with reference to the literature, for example, the similarities/differences to the findings in the literature review.
 Develop theory or models from this comparison and evaluation.
--> 


Conducting a visual inference study allowed a contrast of the traditional choropleth display to the alternative hexagon tile map. 


The visual inference study showed that the hexagon tile map display is a valid alternative as participants achieved higher detection rates for the hexagon tile map when presenting the geographic spatial distribution and the population related distributions.



## Animating between displays
<!--
3. *Communicating the relationship between the hexmap and choropleth map through animation:* Maximise the benefits of both displays when communicating to the public. The use of animations may control how people follow a recognisable map of Australia into an alternative visualisation for inference. 

discuss the results with reference to the literature, for example, the similarities/differences to the findings in the literature review.
-->

Interactivity can allow greater detail to be drawn about small neighbourhoods in a choropleth map. By zooming in, the same shapes shown on the initial map become much larger and comparisons between immediate neighbours becomes simpler. 
Interacting can also allow the map user to drive their exploration. In the case of the Australian Cancer Atlas, the interactive tools allow quick comparisons between areas far from each other on the map. It also allows quick comparisons of the estimated cancer statistics by showing the colours for each cancer type in a table-like display. These additions allow user driven exploration, but do not guarantee that the spatial distribution across the country is digested accurately.


Animating between a choropleth and a hexagon tile map will allows map users to understand how the small communities of a whole country are affected simultaneously. It also teaches map users how to find areas of interest as their attention is drawn to the capital cities, that may not have caught their attention in the display of the choropleth map. When communicating cancer statistics, there should be a balance between providing people a familiar landscape and ensuring the interpret the spatial distribution correctly. A directed exploration of a collection of inner city neighbourhoods will take the distribution out of context, the Australian Cancer Atlas provides some visual tools to combat this by highlighting that the areas displayed are only subsets However, allowing the values of an inner-city neighbourhood to be visible in the context of all other areas will enhance the understanding of the spatial distribution. Animations will communicate a specific message through the capture and direction of users' attention. 

The animations created of the Australian Statistical Areas at Level 2, used in the Australian Cancer Atlas, highlight just how many SA2 areas are hidden due to their size in the choropleth display. The rapid shrinking of the rural areas allows users to recognise the emphasis that had been placed on the large geographic regions.
Their attention is then drawn to the expanding capital cities, and the coastal towns that were not previously visible.


<!--chapter:end:05-discussion.Rmd-->

---
chapter: 6
knit: "bookdown::render_book"
---


# Conclusion {#ch:conclusion}

  <!--  Clearly state the answer to the main research question -->

The first aim of this thesis was to present an alternative visualisation method for spatial data. This thesis has provided a new algorithm to present spatial distributions of disease data, and includes an R code [@R] implementation. The spatial data sets that will be effectively communicated by this display will likely have population related distributions. The hexagon tile map display will represent each area equally on the map space to effectively convey the spatial distribution of the set.

<!--  Summarize and reflect on the research -->
  
The hexagon tile map visualisation method solves the misrepresentation problem of choropleth displays of geographic data sets that contain a substantial amounts of areas. This algorithm is accessible to all R users, in a set of simple functions. It can be applied to any set of areas in an `sf` [@sf] object. 

The tile map allocation provided by the `allocate` function in the `sugarbag` package can easily be used to create animations between a choropleth and hexagon tile map display. Linking the familiar geography to the effective display for understanding the distribution across many heterogeneous geographic regions.
  
The effectiveness of the hexagon tile map has been proved by the visual inference study. It showed that participants could recognise the data display in the set of null distributions more frequently when viewing a hexagon tile map display. The choropleth map display is still effective for distributions that are directly related to the geography, such as the North-West to South-East distribution used in the study.
This has expanded the applications of visual inference studies in a spatial data context.

  
  <!--  Make recommendations for future work on the topic -->
Future work will include expanding on criteria to evaluate the hexagon tile maps produced by the algorithm. The methods to evaluate the alternative displays have not been thoroughly explored in this thesis.
This framework will be used to create relevant tests that contrast the use of the map area, and changes in the visual statistics when the parameter of the hexagon tile map algorithm are altered.

The current hexagon tile map creates a template map that can be used to visualise any data set that contains the areas used to create the map.
There is the possibility of allowing a bivariate display to incorporate uncertainty by using a colour scheme that operates in two directions as suggested by Lucchesi and Wikle [@VUADBC].
The animation methods that allow colours filling the hexagons to flicker communicate uncertainty could also be employed.

With large hexagons, there is a potential to incorporate geofacets [@IGF] to create a tessellated display of small visualisations for each geographic unit. These displays become increasingly complex if the visualisation becomes more detailed, or the hexagons become smaller.

  <!--  Show what new knowledge you have contributed -->
  
This work has contributed a new visualisation for spatial data sets. The spatial distributions of cancer burden for different types of cancers largely relates to the population rather than the geography. The alternative visualisation method highlights the communities, and the hexagon tile map may be implemented in future iterations of the Australian Cancer Atlas to improve the communication of spatial patterns of cancer burden on Australian communities. For wide use by map creators and those interested in alternative visual displays, the code implementation has been provided to any R user with examples and documentation.
This work has also contributed to the literature of visual inference studies, by using the "lineup" protocol developed by Buja et al. and used by @GIIV, and @GTPCCD. This example showed there was a difference in the rate of pattern recognition when participants saw competing spatial map displays.


To communicate human related spatial patterns of disease, map creators should consider the use of alternative displays. The hexagon tile map display has proven effective in this thesis for communicating spatial distributions in sets of heterogeneous geographic units. This thesis provides a practical guide for map creators communicating spatial displays of cancer data in Australia.

<!--chapter:end:06-conclusion.Rmd-->

---
knit: "bookdown::render_book"
---

\appendix

# Visual inference study lineups

```{r data}
library(tidyverse)
library(readxl)
library(cowplot)
library(png)
library(grid)
library(lme4)
library(ggthemes)
library(RColorBrewer)
library(knitr)
library(kableExtra)

trend_colours <- c(
  "NW-SE" = "#B2DF8A",
  "Three Cities" = "#A6CEE3",
  "All Cities" = "#1F78B4")
  
type_colours <- c(
  "Choro." = "#fcae91",
  "Hex." = "#a50f15")

detect_f_colours <- c(
  "No" = "#66C2A5",
  "Yes" = "#FC8D62")

detect_colours <- c(
  "Detected? No" = "#66C2A5",
  "Detected? Yes" = "#FC8D62")

  # Downloaded data
d <- read_xlsx("data/experiment-export.xlsx", sheet=2) %>%
  filter(!is.na(contributor)) %>%
  mutate(contributor = factor(contributor))

# Check data set 
# Need to clean multiple entries, 48, 24
# remove duplicated entries due to submit button
d <- d %>% group_by(group, contributor, image_name) %>%
  slice(1) %>% ungroup() %>% 
  arrange(group, contributor, plot_order)

# Remove contributors who did not provide answers to most questions
keep <- d %>% count(contributor, sort = TRUE) %>% filter(n > 10)
d <- d %>% 
  filter(contributor %in% keep$contributor) %>%
  filter(contributor != "1234567890")

# Remove contributors who did not provide any choices
bad_contribs <- d %>% group_by(contributor) %>% 
  summarise(sum0 = sum(choice)) %>% 
  filter(sum0 == 0) %>% 
  pull(contributor)

d <- d %>% 
  filter(!(contributor %in% bad_contribs))


n_contributors <- d %>% count(contributor, sort=TRUE) %>% 
  summarise(n_contributors = length(contributor))

d <- d %>% mutate(certainty = factor(as.character(certainty),
  levels = c("1", "2", "3", "4","5"), ordered=TRUE))
```


```{r reps}
replicate <- tibble(image_name = c("aus_cities_12_geo.png", "aus_cities_12_hex.png", 
                                   "aus_cities_3_geo.png", "aus_cities_3_hex.png",
                                   "aus_cities_4_geo.png", "aus_cities_4_hex.png",
                                   "aus_cities_9_geo.png", "aus_cities_9_hex.png",
                                   "aus_nwse_2_geo.png", "aus_nwse_2_hex.png",
                                   "aus_nwse_3_geo.png", "aus_nwse_3_hex.png",
                                   "aus_nwse_5_geo.png", "aus_nwse_5_hex.png",
                                   "aus_nwse_6_geo.png", "aus_nwse_6_hex.png",
                                   "aus_three_12_geo.png", "aus_three_12_hex.png",
                                   "aus_three_5_geo.png", "aus_three_5_hex.png",
                                   "aus_three_8_geo.png", "aus_three_8_hex.png",
                                   "aus_three_9_geo.png", "aus_three_9_hex.png"),
                    replicate = c(1, 1, 2, 2, 3, 3, 4, 4, 
                                  1, 1, 2, 2, 3, 3, 4, 4,
                                  1, 1, 2, 2, 3, 3, 4, 4))
# Add rep info to data
d <- d %>% left_join(., replicate, by = "image_name")
```


```{r pdetection_group}
# Tidy for analysis
d <- d %>% 
  separate(image_name, c("nothing", "trend", "location", "type", "extra"), remove = FALSE) %>%
  select(-nothing, -extra) %>%
  mutate(location = as.numeric(location), 
    # detect measures the accuracy of the choice
         detect = ifelse(location == choice, 1, 0)) %>% 
  mutate(trend = case_when(
    trend == "nwse" ~ "NW-SE",
    trend == "cities" ~ "All Cities",
    trend == "three" ~ "Three Cities")) %>% 
  mutate(trend = fct_relevel(trend, "NW-SE","Three Cities","All Cities")) %>% 
  mutate(type = case_when(
    type == "hex" ~"Hex.",
    TRUE~"Choro.")) %>% 
    mutate(detect_f = factor(detect, levels = c(0,1), labels = c("Detected? No", "Detected? Yes")))

plots <- d %>% group_by(group, trend, type, location) %>%
  # pdetect measures the aggregated accuracy of the choices
  summarise(pdetect = length(detect[detect == 1])/length(detect)) 
```


## Overall Performance

The detection rate is considered for each lineup. The detection rates for group A were less varied than the detection rates for the lineups seen by group B. Fig. \ref{fig:pdetection-group} shows the distribution using a boxplot. This shows the median value for detection rate was extremely similar.

```{r pdetection-group}
plots %>% ggplot(aes(x = group, y = pdetect)) + 
  geom_boxplot() + 
  geom_jitter(width = 0.1) +
  ylab("Detection rate") + 
  ylim(c(0,1))
```

The overall detection rate is considered for each trend model in Fig. \ref{fig:pdetect-trend}.
The detection rates for the NW-SE trend model was less varied than the detection rates for the Three Cities and All Cities trends. Fig. \ref{fig:pdetection-group} shows the distribution using a boxplot. This shows the distributions of the rates do not overlap for NW-SE and Three Cities trends, the Three cities range was larger, but the median was much higher for the NW-SE trend. The All Cities trend model distribution overlaps with the NW-SE and All Cities trends.

```{r pdetect-trend}
plots %>% ggplot(aes(x = trend, y = pdetect, fill = trend)) + 
  geom_boxplot() + 
  scale_fill_manual(values = trend_colours) +
  geom_jitter(width = 0.1) +
  ylab("Detection rate") + 
  ylim(c(0,1)) 
```


The boxplots in Fig. \ref{fig:pdetection-type} contrast the distribution of the detection rates for eah type of display.
The detection rates across the lineups was less varied for the hexagon display. There was a large difference in the medians for the types of displays.
Without considering the relationship for each lineup, the hexagon lineup display allowed the participants to achieve higher detection rates.

```{r pdetection-type}
plots %>% ggplot(aes(x = type, y = pdetect, fill = type)) + 
  geom_boxplot() + 
  geom_jitter(width = 0.1) +
  scale_fill_manual(values = type_colours) +
  ylab("Detection rate") + 
  ylim(c(0,1))
```



## Lineups

Each lineup had twelve map displays, this gave participants the choice of any plot, and the choice to not provide a response. this non-reponse is indicated by 0.
The choices made by participants are displayed in Fig. \ref{fig:choices}. The height of each orange lollipop indiates the proportion of participants that selected the map display of real data, they represent the correct choices.
The green lollipops show the proportion of participants that selected the incorrect displays in each lineup.


The proportion of choices are also presented separately for each trend model in Table. \ref{tab:choice-nwse}, Table. \ref{tab:choice-three}, and  Table. \ref{tab:choice-all}.
The correct map display in lineups with a North West to South East trend was chosen correctly with much greater frequency. 
In the lineups of All Cities displays, participants were misled by the choropleth display, but not the hexagon display for all except (2). 
All of Three Cities displays, except (4), were detected in the hexagon display. All except one lineup had at least one participant select the correct map in the lineup as shown in Fig. \ref{fig:choices}.


```{r choices, fig.cap = "Each facet is associated with one lineup, the height of the points show the proportion of the participants that made each choice when considering each lineup. The points coloured orange show the map which contained a trend model, these are the correct choices. The numbers differentiate the replicates of each trend model and type of map display. Participants were able to select 0 to indicate they did not want to choose a map.", fig.height = 8, fig.width =6, results = "asis"}
d %>% 
  count(type, trend, choice, replicate, choice, detect_f) %>% 
  group_by(type, trend, replicate) %>% 
  mutate(prop = n/sum(n)) %>% 
  mutate(repl = paste("Rep:", replicate, ":\n", type,  sep = "")) %>%
  mutate(bottom = 0) %>% 
  ggplot() + 
  geom_point(aes(x = choice, y = prop, color = detect_f), size = 3) + 
  geom_segment(aes(x = choice, xend = choice,y = bottom, yend = prop, colour = detect_f), size = 1) +
  facet_grid(repl ~ trend, 
    drop = TRUE, as.table = TRUE, scales = "free_y") +
  labs(x = "Choice of plot in lineup", y = "Amount of choices") +
  scale_colour_manual(values = detect_colours) +
  scale_x_continuous(breaks = seq(from = 0, to = 12)) +
  scale_y_continuous(breaks = seq(from = 0.0, to = 1.0, by = 0.1)) +
  theme(legend.position = "bottom") + 
  guides(colour = FALSE, fill = FALSE) +
  theme(strip.text.y = element_text(angle = 0))
```


```{r}
choice_tabs <- d %>% 
  count(trend, type, choice, replicate, choice, detect) %>% 
  group_by(trend, type, replicate) %>% 
  mutate(prop = round(n/sum(n), 2)) %>% 
  mutate(repl = paste("Rep:", replicate, ":\n", type,  sep = "")) %>%
  mutate(bottom = 0) %>% 
  select(Trend = trend, Rep = replicate, Type = type, prop, choice) %>% 
  spread(choice, prop, fill = "0") %>% 
  nest(data = c(Rep, Type, `0`, `1`, `2`, `3`, `4`, `5`, `6`, `7`, `8`, `9`, 
    `10`, `11`, `12`))
```

```{r choice-nwse, results = "asis"}
knitr::kable(choice_tabs$data[[1]], format = "latex", align = "rrrrrrrrrrrrrr", escape = FALSE,
  caption = "The proportion of participants who selected each of the twelve map choices in each lineup for NW-SE displays.") %>%
  collapse_rows(., columns = c(1,2))
```


```{r choice-three, results = "asis"}
knitr::kable(choice_tabs$data[[2]], format = "latex", align = "rrrrrrrrrrrrrr", escape = FALSE,
  caption = "The proportion of participants who selected each of the twelve map choices in each lineup for Three Cities displays.") %>%
  collapse_rows(., columns = c(1,2))
```


```{r choice-all, results = "asis"}
knitr::kable(choice_tabs$data[[3]], format = "latex", align = "rrrrrrrrrrrrrr", escape = FALSE,
  caption = "The proportion of participants who selected each of the twelve map choices in each lineup for All Cities displays.") %>%
  collapse_rows(., columns = c(1,2))
```


## North West - South East

The same data set is visualised in both displays, the difference is the land area of each SA3 is coloured in the choropleth and the hexagon representing the SA3 is coloured in the Hexagon Tile Map. 

Lineups were created using the Australian Statistical Areas at Level 3.

## All Cities

### Replicate 1

```{r cities-geo12, results = "asis", fig.cap = "The lineup of choropleth map displays, location 12 contains a distribution that affects all capital cities."}
ggdraw() +
  draw_plot(rasterGrob(readPNG("lineups/aus_cities_12_geo.png")))
```


```{r cities-hex12, results = "asis", fig.cap = "The lineup of hexagon tile map displays, location 12 contains a distribution that affects all capital cities."}
ggdraw() +
  draw_plot(rasterGrob(readPNG("lineups/aus_cities_12_hex.png")))
```


### Replicate 2

```{r cities-geo3, results = "asis", fig.cap = "The lineup of choropleth map displays, location 3 contains a distribution that affects all capital cities."}
ggdraw() +
  draw_plot(rasterGrob(readPNG("lineups/aus_cities_3_geo.png")))
```


```{r cities-hex3, results = "asis", fig.cap = "The lineup of hexagon tile map displays, location 3 contains a distribution that affects all capital cities."}
ggdraw() +
  draw_plot(rasterGrob(readPNG("lineups/aus_cities_3_hex.png")))
```

### Replicate 3

```{r cities-geo4, results = "asis", fig.cap = "The lineup of choropleth map displays, location 4 contains a distribution that affects all capital cities."}
ggdraw() +
  draw_plot(rasterGrob(readPNG("lineups/aus_cities_4_geo.png")))
```


```{r cities-hex4, results = "asis", fig.cap = "The lineup of hexagon tile map displays, location 4 contains a distribution that affects all capital cities."}
ggdraw() +
  draw_plot(rasterGrob(readPNG("lineups/aus_cities_4_hex.png")))
```


### Replicate 4

```{r cities-geo9, results = "asis", fig.cap = "The lineup of choropleth map displays, location 9 contains a distribution that affects all capital cities."}
ggdraw() +
  draw_plot(rasterGrob(readPNG("lineups/aus_cities_9_geo.png")))
```


```{r cities-hex9, results = "asis", fig.cap = "The lineup of hexagon tile map displays, location 9 contains a distribution that affects all capital cities."}
ggdraw() +
  draw_plot(rasterGrob(readPNG("lineups/aus_cities_9_hex.png")))
```


## Three Cities

### Replicate 1

```{r three-geo12, results = "asis", fig.cap = "The lineup of choropleth map displays, location 12 contains a distribution that affects three of the Australian capital cities."}
ggdraw() +
  draw_plot(rasterGrob(readPNG("lineups/aus_three_12_geo.png")))
```


```{r three-hex12, results = "asis", fig.cap = "The lineup of hexagon tile map displays, location 12 contains a distribution that affects three of the Australian capital cities."}
ggdraw() +
  draw_plot(rasterGrob(readPNG("lineups/aus_three_12_hex.png")))
```


### Replicate 2

```{r three-geo5, results = "asis", fig.cap = "The lineup of choropleth map displays, location 3 contains a distribution that affects three of the Australian capital cities."}
ggdraw() +
  draw_plot(rasterGrob(readPNG("lineups/aus_three_5_geo.png")))
```


```{r three-hex5, results = "asis", fig.cap = "The lineup of hexagon tile map displays, location 3 contains a distribution that affects three of the Australian capital cities."}
ggdraw() +
  draw_plot(rasterGrob(readPNG("lineups/aus_three_5_hex.png")))
```

### Replicate 3

```{r three-geo8, results = "asis", fig.cap = "The lineup of choropleth map displays, location 4 contains a distribution that affects three of the Australian capital cities."}
ggdraw() +
  draw_plot(rasterGrob(readPNG("lineups/aus_three_8_geo.png")))
```


```{r three-hex8, results = "asis", fig.cap = "The lineup of hexagon tile map displays, location 4 contains a distribution that affects three of the Australian capital cities."}
ggdraw() +
  draw_plot(rasterGrob(readPNG("lineups/aus_three_8_hex.png")))
```


### Replicate 4

```{r three-geo9, results = "asis", fig.cap = "The lineup of choropleth map displays, location 9 contains a distribution that affects three of the Australian capital cities."}
ggdraw() +
  draw_plot(rasterGrob(readPNG("lineups/aus_three_9_geo.png")))
```


```{r three-hex9, results = "asis", fig.cap = "The lineup of hexagon tile map displays, location 9 contains a distribution that affects three of the Australian capital cities."}
ggdraw() +
  draw_plot(rasterGrob(readPNG("lineups/aus_three_9_hex.png")))
```



## North West to South East Geographic Trend

### Replicate 1

```{r nwse-geo2, results = "asis", fig.cap = "The lineup of choropleth map displays, location 12 contains a distribution that affects all capital nwse."}
ggdraw() +
  draw_plot(rasterGrob(readPNG("lineups/aus_nwse_2_geo.png")))
```


```{r nwse-hex2, results = "asis", fig.cap = "The lineup of hexagon tile map displays, location 12 contains a distribution that affects all capital nwse."}
ggdraw() +
  draw_plot(rasterGrob(readPNG("lineups/aus_nwse_2_geo.png")))
```


### Replicate 2

```{r nwse-geo3, results = "asis", fig.cap = "The lineup of choropleth map displays, location 3 contains a distribution that affects all capital nwse."}
ggdraw() +
  draw_plot(rasterGrob(readPNG("lineups/aus_nwse_3_geo.png")))
```


```{r nwse-hex3, results = "asis", fig.cap = "The lineup of hexagon tile map displays, location 3 contains a distribution that affects all capital nwse."}
ggdraw() +
  draw_plot(rasterGrob(readPNG("lineups/aus_nwse_3_geo.png")))
```

### Replicate 3

```{r nwse-geo5, results = "asis", fig.cap = "The lineup of choropleth map displays, location 4 contains a distribution that affects all capital nwse."}
ggdraw() +
  draw_plot(rasterGrob(readPNG("lineups/aus_nwse_5_geo.png")))
```


```{r nwse-hex5, results = "asis", fig.cap = "The lineup of hexagon tile map displays, location 4 contains a distribution that affects all capital nwse."}
ggdraw() +
  draw_plot(rasterGrob(readPNG("lineups/aus_nwse_5_geo.png")))
```


### Replicate 4

```{r nwse-geo6, results = "asis", fig.cap = "The lineup of choropleth map displays, location 9 contains a distribution that affects all capital nwse."}
ggdraw() +
  draw_plot(rasterGrob(readPNG("lineups/aus_nwse_6_geo.png")))
```


```{r nwse-hex6, results = "asis", fig.cap = "The lineup of hexagon tile map displays, location 9 contains a distribution that affects all capital nwse."}
ggdraw() +
  draw_plot(rasterGrob(readPNG("lineups/aus_nwse_6_geo.png")))
```


<!--chapter:end:A-Study_lineups.Rmd-->

---
knit: "bookdown::render_book"
---


```{r libraries}
library(cowplot)
library(grid)
library(gridExtra)
library(png)
```

# Visual inference study survey procedure

Participants were recruited via advertising on the Figure-Eight crowdsource platform.
Choosing the task from the list directed all potential participants to the page of instructions.
This page contained written instructions and is shown in Fig. \ref{fig:instruct}. 


```{r instruct, results = "asis", fig.cap = "The training lineups of choropleth maps."}
ggdraw() +
  draw_plot(grid::rasterGrob(readPNG("figures/fig8_instruct.png")))
```


## Training

The participants were trained using three displays. There were relatively simple lineups, they are displayed in Fig. \ref{fig:training1} and Fig. \ref{fig:training2}.


```{r training1, results = "asis", fig.cap = "The training lineups of choropleth maps."}
ggdraw() +
  draw_plot(grid::rasterGrob(readPNG("figures/fig8_training1.png")))
```


```{r training2, results = "asis", fig.cap = "The training lineups of hexagon tile maps."}
ggdraw() +
  draw_plot(grid::rasterGrob(readPNG("figures/fig8_training2.png")))
```


## Survey application

The survey application was a `shinydashboard` we application, hosted on a website external to the Figure-Eight platform. The link to the survey was located at the bottom of the instructions and training page. Only participants who had read all of the instructions and seen the example image sets continued to the survey via the link.
This page also contained a question that asked participants for a validation code. The participants unique validation code was generated upon them opening the web application. This code was released to participants when they had considered all twelve lineups and submitted their responses to the `googlesheets` data set. Their validation codes were contained in the data set and associated with each of their responses.

The demographic and consent page of the `shinydashboard` web application are displayed in Fig. \ref{fig:survey-demogs}. Two example lineups are shown, one choropleth map lineup in Fig. \ref{fig:survey-choro} and one heaxgon tile map lineup in Fig. \ref{fig:survey-hex}.


```{r survey-demogs, results = "asis", fig.cap = "The demographics questions tab of the shinydashboard survey application."}
ggdraw() +
  draw_plot(grid::rasterGrob(readPNG("figures/survey_demogs.png")))
```



```{r survey-choro, results = "asis", fig.cap = "An example of the choropleth map lineup shown in the survey tab of the shinydashboard app."}
ggdraw() +
  draw_plot(grid::rasterGrob(readPNG("figures/survey_choro.png")))
```




```{r survey-hex, results = "asis", fig.cap = "An example of the hexagon tile map lineup shown in the survey tab of the shinydashboard app."}
ggdraw() +
  draw_plot(grid::rasterGrob(readPNG("figures/survey_hex.png")))
```

<!--chapter:end:B-Study_procedures.Rmd-->

---
knit: "bookdown::render_book"
---

# Ethics Approval {#ch:ethics}

\includepdf[pages = {1-}, scale=1]{Ethics_1.pdf}

<!--chapter:end:C-ethics.Rmd-->

